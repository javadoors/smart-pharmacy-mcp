# smart-pharmacy-mcp
ç›®å‰åœ¨ç»è¥ä¸€ä¸ªè¯åº—ï¼Œéœ€è¦å¼€å‘ä¸€ä¸ªæ™ºèƒ½å”®è¯å¹³å°ç³»ç»Ÿï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹åŠŸèƒ½ï¼š
1. è¯å“æ£€ç´¢å·¥å…·
   - ä»åº“å­˜ç³»ç»ŸæŸ¥è¯¢å‡ºæ‰€æœ‰è¯å“åç§°
   - æ ¹æ®è¯å“åç§°é€šè¿‡å¤§æ¨¡å‹æ„å»ºè¯å“åŸºç¡€ä¿¡æ¯
   - æŠŠè¯å“åŸºç¡€ä¿¡æ¯å­˜å…¥Milvuså‘é‡æ•°æ®åº“
2. è§„åˆ™å¼•æ“å·¥å…·
   - ä»è¯å“æ£€ç´¢å·¥å…·ä¸­æŸ¥è¯¢å‡ºè¯å“
   - å¯¹è¯å“æ£€æŸ¥ç¦å¿Œã€å¤„æ–¹è¯ã€çº¢æ——æ ‡è¯†
   - è¿”å›æ˜¯å¦é˜»æ­¢
3.  ç—‡çŠ¶è§£æå·¥å…·
   - è¾“å…¥ç—‡çŠ¶æ–‡æœ¬
   - é€šè¿‡ç—‡çŠ¶ä»è¯å“æ£€ç´¢å·¥å…·ä¸­æŸ¥è¯¢å‡ºé™å®šèŒƒå›´å†…çš„è¯å“
   - å¯¹é™å®šèŒƒå›´è¯å“è¿›è¡Œè§„åˆ™å¼•æ“è¿‡æ»¤ï¼Œç»™å‡ºè¯å“æœ€å°é›†
   - æŠŠç—‡çŠ¶åŠè¯å“æœ€å°é›†è¾“å…¥å¤§æ¨¡å‹ï¼Œç»™å‡ºç”¨è¯æ¸…å•
   - æ ¹æ®ç”¨è¯æ¸…å•ï¼Œä»åº“å­˜æŸ¥è¯¢åŸºç¡€ä¿¡æ¯åŠä»·æ ¼
   - ç”¨æˆ·ç”Ÿæˆè®¢å•æ•°æ®ï¼Œæ ¹æ®ä¼šå‘˜çº§åˆ«ç»™å‡ºå¯¹åº”æŠ˜æ‰£
   - ç”¨æˆ·ä»˜æ¬¾
4. æŠ€æœ¯é€‰å‹
   - å¼€å‘è¯­è¨€ï¼špython/vue3
   - å¤§æ¨¡å‹ï¼šDeepseek chat
   - MCPæ¡†æ¶ï¼šLangChain

## æ™ºèƒ½å”®è¯å¹³å°ç³»ç»Ÿæ€»ä½“æ–¹æ¡ˆè®¾è®¡
ä½ è¦çš„æ˜¯ä¸€ä¸ªèƒ½è½åœ°ã€å¯å®¡è®¡ã€å¯æ‰©å±•çš„ç³»ç»Ÿâ€”â€”æ—¢è¦æŠŠè¯å“çŸ¥è¯†â€œè£…è¿›è„‘å­â€ï¼Œåˆè¦æŠŠé£é™©â€œæ‹¦åœ¨é—¨å£â€ã€‚ä¸‹é¢ç»™ä½ ä¸€å¥—ç«¯åˆ°ç«¯æ–¹æ¡ˆï¼Œè¦†ç›–æ¶æ„ã€æ•°æ®æ¨¡å‹ã€æ ¸å¿ƒæµç¨‹ã€MCP/LangChainç¼–æ’ã€åˆè§„ä¸éƒ¨ç½²ï¼Œå¹¶ç»™å‡ºå…³é”®ä»£ç éª¨æ¶ï¼ˆPython/Vue3ï¼‰ã€‚
### ç³»ç»Ÿæ¶æ„ä¸æ¨¡å—åˆ’åˆ†
#### æ ¸å¿ƒç»„ä»¶
- **å‰ç«¯ï¼ˆVue3ï¼‰**ï¼šæ£€ç´¢ã€ç—‡çŠ¶è¾“å…¥ã€è§„åˆ™æç¤ºã€è´­ç‰©è½¦ä¸ç»“ç®—ã€‚
- **API ç½‘å…³**ï¼šç»Ÿä¸€é‰´æƒã€é€Ÿç‡é™åˆ¶ã€å®¡è®¡æ‰“ç‚¹ã€‚
- **åº”ç”¨æœåŠ¡ï¼ˆPython/FastAPIï¼‰**ï¼š
  - **è¯å“æ£€ç´¢å·¥å…·**ï¼šåº“å­˜â†’åŸºç¡€ä¿¡æ¯â†’åµŒå…¥â†’Milvuså…¥åº“ä¸æŸ¥è¯¢ã€‚
  - **è§„åˆ™å¼•æ“å·¥å…·**ï¼šç¦å¿Œ/å¤„æ–¹/çº¢æ——æ ¡éªŒä¸é˜»æ­¢å†³ç­–ã€‚
  - **ç—‡çŠ¶è§£æå·¥å…·**ï¼šç—‡çŠ¶â†’å€™é€‰è¯å“â†’è§„åˆ™è¿‡æ»¤â†’ç”¨è¯æ¸…å•â†’è®¢å•ã€‚
- **å‘é‡æ•°æ®åº“ï¼ˆMilvusï¼‰**ï¼šè¯å“å‘é‡ç´¢å¼•ä¸æ£€ç´¢ï¼ˆRAGï¼‰ã€‚
- **å…³ç³»å‹æ•°æ®åº“ï¼ˆPostgreSQL/MySQLï¼‰**ï¼šåº“å­˜ã€ä»·æ ¼ã€è®¢å•ã€ä¼šå‘˜ã€å®¡è®¡æ—¥å¿—ã€‚
- **å¤§æ¨¡å‹ï¼ˆDeepSeek Chatï¼‰**ï¼šè¯å“åŸºç¡€ä¿¡æ¯ç”Ÿæˆã€ç—‡çŠ¶åˆ°ç”¨è¯å»ºè®®ã€è§£é‡Šè¯´æ˜ï¼ˆOpenAIé£æ ¼APIï¼‰ã€‚
- **LangChainï¼ˆMCP ç¼–æ’ï¼‰**ï¼šå·¥å…·æ³¨å†Œã€è°ƒç”¨é“¾è·¯ã€ä¸Šä¸‹æ–‡ç®¡ç†ã€é”™è¯¯å›é€€ä¸å®¡è®¡ã€‚
- **èº«ä»½ä¸åˆè§„**ï¼šOAuth2/JWTã€è§’è‰²ï¼ˆè¯å¸ˆ/åº—å‘˜/ä¼šå‘˜ï¼‰ã€å¤„æ–¹ä¸Šä¼ ä¸ç•™å­˜ã€æ“ä½œç•™ç—•ã€‚
#### é€»è¾‘åˆ†å±‚
- **Domain å±‚**ï¼šè¯å“ã€ç—‡çŠ¶ã€è§„åˆ™ã€è®¢å•ç­‰é¢†åŸŸå¯¹è±¡ä¸æœåŠ¡ã€‚
- **Tool å±‚ï¼ˆMCPï¼‰**ï¼šæ£€ç´¢ã€è§„åˆ™ã€ç—‡çŠ¶è§£æä¸‰ä¸ªå·¥å…·çš„ç»Ÿä¸€æ¥å£ä¸ç¼–æ’ã€‚
- **Infra å±‚**ï¼šMilvusã€RDBMSã€æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¯é€‰ï¼Œç”¨äºå¼‚æ­¥å®¡è®¡ä¸é£æ§ï¼‰ã€‚
### æ•°æ®æ¨¡å‹ä¸å‘é‡ç´¢å¼•
#### å…³ç³»å‹è¡¨ï¼ˆç¤ºä¾‹ï¼‰
- **drugs**ï¼š`id, name, generic_name, spec, manufacturer, is_rx, contraindications_json, flags_json`
- **inventory**ï¼š`drug_id, stock, batch_no, expire_date`
- **prices**ï¼š`drug_id, list_price, member_tier, discount_rate`
- **orders / order_items**ï¼šè®¢å•ä¸æ˜ç»†
- **members**ï¼š`member_id, tier, points`
- **audit_logs**ï¼š`actor, action, entity, before, after, timestamp`
#### Milvus é›†åˆï¼ˆè¯å“å‘é‡ï¼‰
- **collection**ï¼š`drugs_vectors`
- **schema**ï¼š
  - `drug_id (INT64, PK)`
  - `name (VARCHAR)`
  - `embedding (FLOAT_VECTOR, dim=1536)`ï¼ˆç¤ºä¾‹ç»´åº¦ï¼Œå–å†³äºæ‰€ç”¨ embedding æ¨¡å‹ï¼‰
  - `metadata (JSON)`ï¼šåŸºç¡€ä¿¡æ¯ã€ç¦å¿Œã€é€‚åº”ç—‡ç­‰
- **ç´¢å¼•**ï¼š`IVF_FLAT` æˆ– `HNSW`ï¼ˆè§†è§„æ¨¡ä¸å»¶è¿Ÿè¦æ±‚ï¼‰
- **åº¦é‡**ï¼š`COSINE` æˆ– `L2`
### ä¸‰å¤§å·¥å…·çš„ç«¯åˆ°ç«¯æµç¨‹
#### 1) è¯å“æ£€ç´¢å·¥å…·
- **è¾“å…¥**ï¼šæ— ï¼ˆåˆå§‹åŒ–ï¼‰/è¯å“åç§°æˆ–è¯­ä¹‰æŸ¥è¯¢ã€‚
- **æµç¨‹**ï¼š
  1. ä»åº“å­˜ç³»ç»Ÿæ‹‰å–è¯å“æ¸…å•ï¼ˆæ‰¹é‡æˆ–å¢é‡ï¼‰ã€‚
  2. è°ƒç”¨ DeepSeek ç”Ÿæˆè¯å“åŸºç¡€ä¿¡æ¯ï¼ˆé€‚åº”ç—‡ã€ç¦å¿Œã€ç”¨æ³•ç”¨é‡ã€æ˜¯å¦å¤„æ–¹è¯ã€çº¢æ——æ ‡è¯†å»ºè®®ï¼‰ã€‚
  3. å¯¹åŸºç¡€ä¿¡æ¯åšæ¸…æ´—ä¸ç»“æ„åŒ–ï¼ˆJSON Schemaï¼‰ã€‚
  4. ç”Ÿæˆæ–‡æœ¬æ‹¼æ¥ï¼ˆåç§°+é€‚åº”ç—‡+ç¦å¿Œ+è¯´æ˜ï¼‰â†’Embeddingâ†’å†™å…¥ Milvusã€‚
  5. æä¾›è¯­ä¹‰æ£€ç´¢ APIï¼šå…³é”®è¯/ç—‡çŠ¶çŸ­è¯­â†’å‘é‡æŸ¥è¯¢â†’è¿”å›å€™é€‰è¯å“ã€‚
- **è¾“å‡º**ï¼šå€™é€‰è¯å“åˆ—è¡¨ï¼ˆå«åŸºç¡€ä¿¡æ¯ä¸ç›¸ä¼¼åº¦ï¼‰ã€‚
#### 2) è§„åˆ™å¼•æ“å·¥å…·
- **è¾“å…¥**ï¼šè¯å“å¯¹è±¡ï¼ˆå«åŸºç¡€ä¿¡æ¯ä¸æ ‡è¯†ï¼‰ã€ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼ˆå¹´é¾„ã€è¿‡æ•å²ã€å¦Šå¨ ã€å¹¶ç”¨è¯ç­‰ï¼‰ã€‚
- **è§„åˆ™é›†**ï¼ˆå¯é…ç½®ï¼‰ï¼š
  - **ç¦å¿Œ**ï¼šå¦‚â€œå¦Šå¨ ç¦ç”¨â€â€œè‚è‚¾åŠŸèƒ½ä¸å…¨æ…ç”¨â€ç­‰ã€‚
  - **å¤„æ–¹è¯**ï¼šæ— å¤„æ–¹åˆ™é˜»æ­¢ï¼›æœ‰å¤„æ–¹åˆ™éœ€è¯å¸ˆå¤æ ¸ã€‚
  - **çº¢æ——æ ‡è¯†**ï¼šé«˜é£é™©æç¤ºï¼ˆå¹´é¾„<Xã€ç—‡çŠ¶æŒç»­>Yå¤©ã€å‘çƒ­>Zâ„ƒç­‰ï¼‰ã€‚
- **å†³ç­–è¾“å‡º**ï¼š`allow | block | require_pharmacist_review`ï¼Œå¹¶è¿”å›åŸå› ä¸è¯æ®è·¯å¾„ï¼ˆå®¡è®¡ï¼‰ã€‚
#### 3) ç—‡çŠ¶è§£æå·¥å…·
- **è¾“å…¥**ï¼šç—‡çŠ¶æ–‡æœ¬ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰ã€‚
- **æµç¨‹**ï¼š
  1. ç—‡çŠ¶â†’å‘é‡æ£€ç´¢ï¼ˆMilvusï¼‰é™å®šå€™é€‰è¯å“é›†åˆï¼ˆTop-Kï¼‰ã€‚
  2. å¯¹å€™é€‰é›†åˆé€ä¸€æ‰§è¡Œè§„åˆ™å¼•æ“è¿‡æ»¤â†’å¾—åˆ°â€œè¯å“æœ€å°é›†â€ï¼ˆæ»¡è¶³å®‰å…¨ä¸é€‚åº”ç—‡ï¼‰ã€‚
  3. å°†ç—‡çŠ¶+æœ€å°é›†å–‚ç»™ DeepSeekï¼Œç”Ÿæˆ**ç”¨è¯æ¸…å•**ï¼ˆå«ç”¨æ³•ç”¨é‡ã€æ³¨æ„äº‹é¡¹ã€ä½•æ—¶å°±åŒ»ï¼‰ã€‚
  4. æ ¹æ®æ¸…å•æŸ¥è¯¢åº“å­˜ä¸ä»·æ ¼ï¼Œè®¡ç®—ä¼šå‘˜æŠ˜æ‰£ï¼Œç”Ÿæˆè®¢å•è‰æ¡ˆã€‚
  5. ç”¨æˆ·ç¡®è®¤â†’æ”¯ä»˜â†’è½åº“â†’å®¡è®¡è®°å½•ã€‚
- **è¾“å‡º**ï¼šå¯ä¸‹å•çš„ç”¨è¯æ¸…å•ä¸è§£é‡Šè¯´æ˜ã€‚
### LangChainï¼ˆMCPï¼‰ç¼–æ’è®¾è®¡
#### å·¥å…·æ³¨å†Œ
- **Tool: drug_search**ï¼ˆMilvus è¯­ä¹‰æ£€ç´¢ï¼‰
- **Tool: rule_engine**ï¼ˆç¦å¿Œ/å¤„æ–¹/çº¢æ——ï¼‰
- **Tool: symptom_to_plan**ï¼ˆç—‡çŠ¶â†’ç”¨è¯å»ºè®®ï¼Œè°ƒç”¨ DeepSeekï¼‰
- **Tool: pricing_inventory**ï¼ˆåº“å­˜ä¸ä»·æ ¼æŸ¥è¯¢ï¼‰
- **Tool: order_checkout**ï¼ˆè®¢å•ä¸æŠ˜æ‰£è®¡ç®—ã€æ”¯ä»˜é¢„å¤„ç†ï¼‰
#### è°ƒç”¨é“¾è·¯ï¼ˆç®€åŒ–ï¼‰
1. `symptom_to_plan`ï¼š
   - è°ƒç”¨ `drug_search` è·å– Top-Kã€‚
   - å¹¶è¡Œè°ƒç”¨ `rule_engine` è¿‡æ»¤ã€‚
   - æ±‡æ€»æœ€å°é›†â†’æç¤ºè¯æ„é€ â†’DeepSeek ç”Ÿæˆç”¨è¯æ¸…å•ã€‚
2. `pricing_inventory`ï¼š
   - å¯¹æ¸…å•é€é¡¹æŸ¥è¯¢åº“å­˜ä¸ä»·æ ¼ã€‚
3. `order_checkout`ï¼š
   - è®¡ç®—ä¼šå‘˜æŠ˜æ‰£â†’ç”Ÿæˆè®¢å•â†’è¿”å›æ”¯ä»˜é“¾æ¥æˆ–äºŒç»´ç ã€‚
#### å®¡è®¡ä¸å¯è¿½æº¯
- æ¯æ¬¡å·¥å…·è°ƒç”¨è®°å½•ï¼š`tool_name, input_hash, output_hash, latency, actor, decision`
- å¯¹æ¨¡å‹ç”Ÿæˆå†…å®¹ä¿å­˜æç¤ºè¯ä¸å“åº”æ‘˜è¦ï¼ˆåˆè§„è„±æ•ï¼‰ã€‚
### å…³é”®æ¥å£ä¸ä»£ç éª¨æ¶ï¼ˆPython/FastAPI + LangChainï¼‰
#### ä¾èµ–å®‰è£…ï¼ˆç¤ºä¾‹ï¼‰
```bash
pip install fastapi uvicorn langchain pymilvus pydantic requests python-dotenv
```
#### é…ç½®ä¸å®¢æˆ·ç«¯åˆå§‹åŒ–ï¼ˆDeepSeek & Milvusï¼‰
```python
# config.py
import os
from dotenv import load_dotenv
from pymilvus import connections, Collection

load_dotenv()
DEEPSEEK_API_KEY = os.getenv("DEEPSEEK_API_KEY")
MILVUS_HOST = os.getenv("MILVUS_HOST", "localhost")
MILVUS_PORT = os.getenv("MILVUS_PORT", "19530")

def init_milvus():
    connections.connect(host=MILVUS_HOST, port=MILVUS_PORT)
    return Collection("drugs_vectors")  # éœ€æå‰åˆ›å»ºå¹¶å»ºç´¢å¼•
```
ï¼ˆDeepSeek æä¾› OpenAI é£æ ¼ APIï¼Œå¯ç”¨ `requests` æˆ– OpenAI SDK å…¼å®¹æ–¹å¼è°ƒç”¨ã€‚ï¼‰
#### è¯å“æ£€ç´¢å·¥å…·ï¼ˆå‘é‡å…¥åº“ä¸æŸ¥è¯¢ï¼‰
```python
# tools/drug_search.py
from typing import List, Dict
from pymilvus import Collection
import numpy as np

def embed_text(text: str) -> List[float]:
    # è°ƒç”¨ DeepSeek embeddingï¼ˆä¼ªä»£ç ï¼‰
    # resp = requests.post("https://api.deepseek.com/v1/embeddings", headers=..., json=...)
    # return resp["data"][0]["embedding"]
    return np.random.rand(1536).tolist()  # å ä½

def upsert_drug(col: Collection, drug: Dict):
    vec = embed_text(
        f"{drug['name']} {drug['indications']} {drug['contraindications']} {drug['desc']}"
    )
    col.insert([
        [drug["id"]],
        [drug["name"]],
        [vec],
        [drug]  # metadata json
    ])

def search_drugs(col: Collection, query: str, top_k: int = 10) -> List[Dict]:
    qvec = embed_text(query)
    res = col.search([qvec], "embedding", params={"metric_type": "COSINE"}, limit=top_k,
                     output_fields=["drug_id", "name", "metadata"])
    return [{"drug_id": r.id, "name": r.entity.get("name"), "meta": r.entity.get("metadata")}
            for hits in res for r in hits]
```
#### è§„åˆ™å¼•æ“å·¥å…·ï¼ˆå¯é…ç½®è§„åˆ™ï¼‰
```python
# tools/rule_engine.py
from typing import Dict

def evaluate_rules(drug: Dict, user_ctx: Dict) -> Dict:
    reasons = []
    decision = "allow"

    # å¤„æ–¹è¯
    if drug["is_rx"] and not user_ctx.get("prescription_uploaded"):
        decision = "require_pharmacist_review"
        reasons.append("å¤„æ–¹è¯éœ€è¯å¸ˆå¤æ ¸æˆ–ä¸Šä¼ å¤„æ–¹")

    # ç¦å¿Œç¤ºä¾‹
    contraindications = drug.get("contraindications", [])
    if "pregnancy" in contraindications and user_ctx.get("pregnant"):
        decision = "block"
        reasons.append("å¦Šå¨ ç¦ç”¨")

    # çº¢æ——ç¤ºä¾‹
    flags = drug.get("flags", [])
    if "fever_high" in flags and user_ctx.get("fever_celsius", 0) >= 39:
        decision = "require_pharmacist_review"
        reasons.append("é«˜çƒ­çº¢æ——ï¼Œå»ºè®®çº¿ä¸‹å°±åŒ»")

    return {"decision": decision, "reasons": reasons}
```
#### ç—‡çŠ¶è§£æå·¥å…·ï¼ˆç¼–æ’ï¼‰
```python
# tools/symptom_to_plan.py
from typing import List, Dict
from .drug_search import search_drugs
from .rule_engine import evaluate_rules

def generate_plan(deepseek_client, symptom_text: str, col, user_ctx: Dict) -> Dict:
    candidates = search_drugs(col, symptom_text, top_k=20)
    minimal_set = []
    for c in candidates:
        r = evaluate_rules(c["meta"], user_ctx)
        if r["decision"] == "allow":
            minimal_set.append({"drug": c, "rule": r})
    # æç¤ºè¯æ„é€ ï¼ˆç—‡çŠ¶+æœ€å°é›†ï¼‰
    prompt = {
        "symptom": symptom_text,
        "candidates": [{"name": d["drug"]["name"], "indications": d["drug"]["meta"]["indications"]} for d in minimal_set],
        "constraints": user_ctx
    }
    # è°ƒç”¨ DeepSeek ç”Ÿæˆç”¨è¯æ¸…å•ï¼ˆä¼ªä»£ç ï¼‰
    # resp = deepseek_client.chat.completions.create(model="deepseek-chat", messages=[...])
    plan = {"items": [{"drug_id": d["drug"]["drug_id"], "dose": "æŒ‰è¯´æ˜ä¹¦", "notes": "å¤šé¥®æ°´"} for d in minimal_set]}
    return {"plan": plan, "explain": "æ¨¡å‹ç”Ÿæˆçš„ç”¨è¯å»ºè®®ï¼ˆéœ€è¯å¸ˆå¤æ ¸ï¼‰"}
```
#### ä»·æ ¼ä¸åº“å­˜ã€è®¢å•ä¸æŠ˜æ‰£
```python
# tools/pricing_inventory.py
def enrich_with_price_inventory(db, plan, member_tier: str):
    items = []
    for it in plan["items"]:
        inv = db.get_inventory(it["drug_id"])
        price = db.get_price(it["drug_id"], member_tier)
        items.append({
            **it,
            "stock": inv["stock"],
            "unit_price": price["list_price"],
            "discount_rate": price.get("discount_rate", 1.0),
            "final_price": price["list_price"] * price.get("discount_rate", 1.0)
        })
    return items

# tools/order_checkout.py
def create_order(db, member_id: int, items: list):
    total = sum(i["final_price"] for i in items)
    order_id = db.insert_order(member_id, items, total)
    return {"order_id": order_id, "total": total, "payment_qr": f"/pay/{order_id}"}
```
#### FastAPI è·¯ç”±ï¼ˆç¤ºä¾‹ï¼‰
```python
# app.py
from fastapi import FastAPI, Depends
from config import init_milvus
from tools.symptom_to_plan import generate_plan
from tools.pricing_inventory import enrich_with_price_inventory
from tools.order_checkout import create_order

app = FastAPI()
col = init_milvus()

@app.post("/symptom/plan")
def symptom_plan(payload: dict, user=Depends(...)):
    user_ctx = payload.get("user_ctx", {})
    plan = generate_plan(deepseek_client=None, symptom_text=payload["symptom"], col=col, user_ctx=user_ctx)
    items = enrich_with_price_inventory(db=..., plan=plan["plan"], member_tier=user["tier"])
    order = create_order(db=..., member_id=user["id"], items=items)
    return {"plan": plan, "items": items, "order": order}
```
### å‰ç«¯ï¼ˆVue3ï¼‰é¡µé¢ä¸äº¤äº’
#### é¡µé¢
- **è¯å“æ£€ç´¢**ï¼šå…³é”®è¯/ç—‡çŠ¶è¾“å…¥â†’å€™é€‰åˆ—è¡¨â†’è§„åˆ™æç¤ºå¾½ç« ï¼ˆç¦å¿Œ/å¤„æ–¹/çº¢æ——ï¼‰ã€‚
- **ç—‡çŠ¶è§£æ**ï¼šè¾“å…¥ç—‡çŠ¶â†’ç”Ÿæˆç”¨è¯æ¸…å•â†’åº“å­˜ä¸ä»·æ ¼â†’åŠ å…¥è´­ç‰©è½¦ã€‚
- **ç»“ç®—**ï¼šä¼šå‘˜æŠ˜æ‰£å±•ç¤ºâ†’æ”¯ä»˜äºŒç»´ç â†’è®¢å•çŠ¶æ€è½®è¯¢ã€‚
- **å®¡è®¡ä¸å¤æ ¸**ï¼ˆè¯å¸ˆç«¯ï¼‰ï¼šæŸ¥çœ‹æ¨¡å‹å»ºè®®ã€è§„åˆ™å†³ç­–ã€å…è®¸/é˜»æ­¢/ä¿®æ”¹ã€‚
#### ç»„ä»¶è¦ç‚¹
- **Badge æç¤º**ï¼š`ç¦å¿Œ/å¤„æ–¹/çº¢æ——` ä¸‰è‰²æ ‡è¯†ã€‚
- **Explain é¢æ¿**ï¼šå±•ç¤ºæ¨¡å‹ç”Ÿæˆçš„ç†ç”±ä¸è§„åˆ™å‘½ä¸­ç‚¹ã€‚
- **åˆè§„å¼¹çª—**ï¼šå¤„æ–¹è¯ä¸‹å•å‰å¿…é¡»ä¸Šä¼ å¤„æ–¹æˆ–è¯å¸ˆå¤æ ¸ã€‚
### åˆè§„ã€å®‰å…¨ä¸å®¡è®¡
- **è§’è‰²ä¸æƒé™**ï¼šä¼šå‘˜ã€åº—å‘˜ã€è¯å¸ˆã€ç®¡ç†å‘˜åˆ†çº§æˆæƒã€‚
- **å¤„æ–¹ç®¡ç†**ï¼šä¸Šä¼ ã€OCRï¼ˆå¯é€‰ï¼‰ã€è¯å¸ˆå¤æ ¸è®°å½•ã€ç•™å­˜æœŸä¸è®¿é—®å®¡è®¡ã€‚
- **æ•°æ®æœ€å°åŒ–**ï¼šä»…ä¿ç•™å¿…è¦çš„ç”¨æˆ·å¥åº·ä¿¡æ¯ï¼Œæ•æ„Ÿå­—æ®µåŠ å¯†å­˜å‚¨ã€‚
- **å¯è§£é‡Šæ€§**ï¼šæ¨¡å‹è¾“å‡ºé™„å¸¦æç¤ºè¯æ‘˜è¦ä¸è§„åˆ™å‘½ä¸­ç‚¹ï¼›æ‰€æœ‰è‡ªåŠ¨å†³ç­–å¯äººå·¥è¦†ç›–ã€‚
- **é£æ§**ï¼šé«˜é£é™©ç—‡çŠ¶ï¼ˆçº¢æ——ï¼‰å¼ºåˆ¶å»ºè®®çº¿ä¸‹å°±åŒ»ï¼›é¢‘ç¹è´­ä¹°ç‰¹å®šè¯å“è§¦å‘äººå·¥å¤æ ¸ã€‚
- **æ—¥å¿—ä¸è¿½æº¯**ï¼šå·¥å…·è°ƒç”¨ã€æ¨¡å‹å“åº”ã€è§„åˆ™å†³ç­–ã€è®¢å•å˜æ›´å…¨é‡æ‰“ç‚¹ã€‚
### éƒ¨ç½²ä¸è¿ç»´
- **å®¹å™¨åŒ–**ï¼šå‰åç«¯ã€Milvusã€DB åˆ†åˆ«å®¹å™¨åŒ–ï¼›Kubernetes/Helm ç®¡ç†ã€‚
- **ç¯å¢ƒ**ï¼š`dev/staging/prod` åˆ†å±‚ï¼›API Key ä¸å¯†é’¥ç”¨ Vault/Secrets ç®¡ç†ã€‚
- **ç›‘æ§**ï¼šè¯·æ±‚å»¶è¿Ÿã€Milvus QPS/å¬å›ç‡ã€æ¨¡å‹è°ƒç”¨æˆåŠŸç‡ã€è§„åˆ™é˜»æ­¢ç‡ã€è®¢å•è½¬åŒ–ç‡ã€‚
- **æˆæœ¬æ§åˆ¶**ï¼šEmbedding ä¸ Chat åˆ†è´¦ï¼›ç¼“å­˜çƒ­é—¨è¯å“å‘é‡ä¸è¯´æ˜ï¼›æ‰¹é‡å…¥åº“ç¦»çº¿åŒ–ã€‚
### æŠ€æœ¯é€‰å‹è½åœ°å»ºè®®
- **å¼€å‘è¯­è¨€**ï¼šåç«¯ Pythonï¼ˆFastAPIï¼‰ï¼Œå‰ç«¯ Vue3ï¼ˆViteï¼‰ã€‚
- **å¤§æ¨¡å‹**ï¼šDeepSeek Chatï¼ˆOpenAIé£æ ¼ APIï¼Œä¾¿äºä¸ LangChain é›†æˆï¼‰ã€‚
- **MCP æ¡†æ¶**ï¼šLangChain å·¥å…·åŒ–ç¼–æ’ã€å›é€€ç­–ç•¥ä¸å®¡è®¡ä¸­é—´ä»¶ã€‚
- **å‘é‡åº“**ï¼šMilvusï¼ˆæˆç†Ÿçš„å‘é‡æ£€ç´¢ï¼Œé€‚åˆåŒ»ç–—/é›¶å”®åœºæ™¯çš„ RAGï¼‰ã€‚
- **æ•°æ®åº“**ï¼šPostgreSQL/MySQLï¼›å¿…è¦æ—¶åŠ  Redis åšä¼šè¯ä¸ç¼“å­˜ã€‚
### é£é™©ä¸è¾¹ç•Œ
- **æ¨¡å‹å¹»è§‰**ï¼šæ‰€æœ‰ç”¨è¯å»ºè®®å¿…é¡»æ ‡æ³¨â€œéœ€è¯å¸ˆå¤æ ¸â€ï¼Œå…³é”®è¯å“ä¿¡æ¯ä»¥æƒå¨æ•°æ®æºä¸ºå‡†ã€‚
- **è§„åˆ™è¦†ç›–**ï¼šç¦å¿Œä¸çº¢æ——éœ€æŒç»­ç»´æŠ¤ï¼›å¼•å…¥å¤–éƒ¨è¯å…¸æ•°æ®æºæ—¶è¦åšç‰ˆæœ¬åŒ–ä¸æ¥æºæ ‡æ³¨ã€‚
- **å¤„æ–¹åˆè§„**ï¼šä¸åŒåœ°åŒºæ³•è§„å·®å¼‚ï¼Œå¤„æ–¹ä¸Šä¼ ä¸å®¡æ ¸æµç¨‹éœ€æœ¬åœ°åŒ–ã€‚
- **å¬å›è´¨é‡**ï¼šMilvusæ£€ç´¢æ•ˆæœä¾èµ–åµŒå…¥æ¨¡å‹ä¸æ–‡æœ¬æ¸…æ´—ï¼›å®šæœŸè¯„ä¼° Top-K å‘½ä¸­ç‡ä¸ç”¨æˆ·åé¦ˆã€‚
### ä½ å¯ä»¥å…ˆåšçš„ä¸¤å‘¨å†²åˆºé‡Œç¨‹ç¢‘
1. **Week 1**
   - å»ºè¡¨ä¸ Milvus é›†åˆåˆ›å»ºï¼›åº“å­˜å¯¼å…¥ä¸ 50 ç§å¸¸è§è¯å“åŸºç¡€ä¿¡æ¯ç”Ÿæˆä¸å…¥åº“ã€‚
   - å®Œæˆ `drug_search` ä¸ `rule_engine` çš„ APIã€‚
   - Vue3 åŸå‹é¡µï¼šæ£€ç´¢ä¸è§„åˆ™å¾½ç« å±•ç¤ºã€‚
2. **Week 2**
   - å®Œæˆ `symptom_to_plan` ç¼–æ’ä¸è®¢å•é“¾è·¯ï¼ˆä»·æ ¼/åº“å­˜/æŠ˜æ‰£ï¼‰ã€‚
   - åŠ å…¥å®¡è®¡æ—¥å¿—ä¸è¯å¸ˆå¤æ ¸é¡µã€‚
   - å‹æµ‹ä¸ç°åº¦ä¸Šçº¿ï¼Œæ”¶é›†ç”¨æˆ·åé¦ˆä¸è§„åˆ™å‘½ä¸­æ•°æ®ã€‚
    
## æœ€å°å¯ç”¨ä»“åº“ç»“æ„ï¼ˆPython/FastAPI + Vue3 + Milvus + LangChain + DeepSeekï¼‰
ä¸‹é¢æ˜¯ä¸€å¥—å¯ç›´æ¥è¿è¡Œçš„æœ€å°å¯ç”¨éª¨æ¶ï¼ŒåŒ…å«åç«¯ã€å‰ç«¯ã€å‘é‡åº“ã€å…³ç³»åº“ä¸å®¹å™¨ç¼–æ’ã€‚ä½ å¯ä»¥ä¸€é”® `docker compose up -d` æ‹‰èµ·å…¨æ ˆï¼Œç„¶åç”¨ç§å­æ•°æ®å®Œæˆè¯å“å…¥åº“ã€å‘é‡åŒ–ä¸æ£€ç´¢ã€‚DeepSeek ä½¿ç”¨ OpenAI é£æ ¼ APIï¼ŒMilvus ä½œä¸ºå‘é‡æ£€ç´¢å¼•æ“ï¼ŒLangChain è´Ÿè´£å·¥å…·ç¼–æ’ä¸å®¡è®¡ã€‚å‚è€ƒ Milvus å®˜æ–¹çš„ DeepSeek RAG æ•™ç¨‹å¯å¿«é€Ÿå¯¹é½ä¾èµ–ä¸è°ƒç”¨æ–¹å¼ã€‚ 
### ä»“åº“ç›®å½•ç»“æ„
```text
smart-pharmacy/
â”œâ”€ backend/
â”‚  â”œâ”€ app.py
â”‚  â”œâ”€ config.py
â”‚  â”œâ”€ domain/
â”‚  â”‚  â”œâ”€ models.py
â”‚  â”‚  â””â”€ schemas.py
â”‚  â”œâ”€ tools/
â”‚  â”‚  â”œâ”€ drug_search.py
â”‚  â”‚  â”œâ”€ rule_engine.py
â”‚  â”‚  â”œâ”€ symptom_to_plan.py
â”‚  â”‚  â”œâ”€ pricing_inventory.py
â”‚  â”‚  â””â”€ order_checkout.py
â”‚  â”œâ”€ mcp/
â”‚  â”‚  â”œâ”€ registry.py
â”‚  â”‚  â””â”€ audit.py
â”‚  â”œâ”€ seeds/
â”‚  â”‚  â”œâ”€ drugs.csv
â”‚  â”‚  â””â”€ seed.py
â”‚  â”œâ”€ requirements.txt
â”‚  â””â”€ Dockerfile
â”œâ”€ frontend/
â”‚  â”œâ”€ src/
â”‚  â”‚  â”œâ”€ main.ts
â”‚  â”‚  â”œâ”€ App.vue
â”‚  â”‚  â”œâ”€ pages/
â”‚  â”‚  â”‚  â”œâ”€ Search.vue
â”‚  â”‚  â”‚  â”œâ”€ Symptom.vue
â”‚  â”‚  â”‚  â””â”€ Checkout.vue
â”‚  â”‚  â””â”€ components/
â”‚  â”‚     â”œâ”€ DrugCard.vue
â”‚  â”‚     â”œâ”€ RuleBadge.vue
â”‚  â”‚     â””â”€ ExplainPanel.vue
â”‚  â”œâ”€ index.html
â”‚  â”œâ”€ package.json
â”‚  â””â”€ Dockerfile
â”œâ”€ infra/
â”‚  â”œâ”€ docker-compose.yml
â”‚  â”œâ”€ milvus/
â”‚  â”‚  â”œâ”€ init_collection.py
â”‚  â”‚  â””â”€ README.md
â”‚  â”œâ”€ db/
â”‚  â”‚  â”œâ”€ init.sql
â”‚  â”‚  â””â”€ README.md
â”‚  â””â”€ .env.example
â”œâ”€ Makefile
â””â”€ README.md
```
### ç¯å¢ƒä¸å®¹å™¨ç¼–æ’
#### docker-compose.ymlï¼ˆMilvus + Postgres + Backend + Frontendï¼‰
```yaml
version: "3.9"
services:
  milvus:
    image: milvusdb/milvus:2.4.6
    container_name: milvus
    ports: ["19530:19530", "9091:9091"]
    environment:
      - MILVUS_LOG_LEVEL=info
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "19530"]
      interval: 10s
      timeout: 5s
      retries: 10

  postgres:
    image: postgres:16
    container_name: pharmacy-db
    environment:
      - POSTGRES_PASSWORD=pharmacy
      - POSTGRES_USER=pharmacy
      - POSTGRES_DB=pharmacy
    ports: ["5432:5432"]
    volumes:
      - ./infra/db/init.sql:/docker-entrypoint-initdb.d/init.sql

  backend:
    build: ./backend
    container_name: pharmacy-api
    environment:
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
      - MILVUS_HOST=milvus
      - MILVUS_PORT=19530
      - DB_URL=postgresql://pharmacy:pharmacy@pharmacy-db:5432/pharmacy
    depends_on: [milvus, postgres]
    ports: ["8000:8000"]

  frontend:
    build: ./frontend
    container_name: pharmacy-web
    depends_on: [backend]
    ports: ["5173:5173"]
```
#### åç«¯ Dockerfile
```dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8000"]
```
#### å‰ç«¯ Dockerfile
```dockerfile
FROM node:20-alpine
WORKDIR /app
COPY package.json .
RUN npm install
COPY . .
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]
```
#### .env.example
```env
DEEPSEEK_API_KEY=your_deepseek_key
MILVUS_HOST=localhost
MILVUS_PORT=19530
DB_URL=postgresql://pharmacy:pharmacy@localhost:5432/pharmacy
```
### åç«¯å®ç°ï¼ˆå…³é”®æ–‡ä»¶ï¼‰
#### requirements.txt
```text
fastapi
uvicorn
langchain
pymilvus
psycopg2-binary
pydantic
python-dotenv
requests
```
#### config.py
```python
import os
from dotenv import load_dotenv
from pymilvus import connections, Collection

load_dotenv()
DEEPSEEK_API_KEY = os.getenv("DEEPSEEK_API_KEY")
DB_URL = os.getenv("DB_URL")
MILVUS_HOST = os.getenv("MILVUS_HOST", "localhost")
MILVUS_PORT = os.getenv("MILVUS_PORT", "19530")

def init_milvus():
    connections.connect(host=MILVUS_HOST, port=MILVUS_PORT)
    return Collection("drugs_vectors")  # éœ€å…ˆåˆ›å»º
```
#### infra/milvus/init_collection.py
```python
from pymilvus import connections, FieldSchema, CollectionSchema, DataType, Collection

connections.connect(host="milvus", port="19530")

fields = [
    FieldSchema(name="drug_id", dtype=DataType.INT64, is_primary=True, auto_id=False),
    FieldSchema(name="name", dtype=DataType.VARCHAR, max_length=256),
    FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=1536),
    FieldSchema(name="metadata", dtype=DataType.JSON),
]
schema = CollectionSchema(fields, description="Drug vectors")
col = Collection("drugs_vectors", schema)
col.create_index(field_name="embedding", index_params={"index_type":"HNSW","metric_type":"COSINE","params":{"M":16,"efConstruction":200}})
print("Milvus collection ready.")
```
#### infra/db/init.sql
```sql
CREATE TABLE IF NOT EXISTS drugs (
  id BIGINT PRIMARY KEY,
  name TEXT NOT NULL,
  generic_name TEXT,
  spec TEXT,
  manufacturer TEXT,
  is_rx BOOLEAN DEFAULT FALSE,
  contraindications_json JSONB,
  flags_json JSONB
);

CREATE TABLE IF NOT EXISTS inventory (
  drug_id BIGINT REFERENCES drugs(id),
  stock INT DEFAULT 0,
  batch_no TEXT,
  expire_date DATE
);

CREATE TABLE IF NOT EXISTS prices (
  drug_id BIGINT REFERENCES drugs(id),
  list_price NUMERIC(10,2),
  member_tier TEXT,
  discount_rate NUMERIC(5,2) DEFAULT 1.0
);

CREATE TABLE IF NOT EXISTS orders (
  id BIGSERIAL PRIMARY KEY,
  member_id BIGINT,
  total NUMERIC(10,2),
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS order_items (
  order_id BIGINT REFERENCES orders(id),
  drug_id BIGINT,
  qty INT,
  unit_price NUMERIC(10,2),
  final_price NUMERIC(10,2)
);

CREATE TABLE IF NOT EXISTS audit_logs (
  id BIGSERIAL PRIMARY KEY,
  actor TEXT,
  action TEXT,
  entity TEXT,
  before JSONB,
  after JSONB,
  ts TIMESTAMP DEFAULT NOW()
);
```
#### backend/domain/schemas.pyï¼ˆPydanticï¼‰
```python
from pydantic import BaseModel
from typing import List, Dict, Optional

class UserCtx(BaseModel):
    age: Optional[int] = None
    pregnant: Optional[bool] = None
    prescription_uploaded: Optional[bool] = None
    fever_celsius: Optional[float] = None

class SymptomRequest(BaseModel):
    symptom: str
    user_ctx: UserCtx

class PlanItem(BaseModel):
    drug_id: int
    dose: str
    notes: str

class Plan(BaseModel):
    items: List[PlanItem]
```
#### backend/tools/drug_search.py
```python
from typing import List, Dict
from pymilvus import Collection
import numpy as np

def embed_text(text: str) -> List[float]:
    # è¿™é‡Œå¯æ›¿æ¢ä¸º DeepSeek Embeddingï¼ˆOpenAIé£æ ¼ APIï¼‰
    # å‚è€ƒ Milvus æ–‡æ¡£ä¸­çš„ DeepSeek é›†æˆè¯´æ˜ã€‚ 
    return np.random.rand(1536).tolist()

def upsert_drug(col: Collection, drug: Dict):
    vec = embed_text(
        f"{drug['name']} {drug.get('indications','')} {drug.get('contraindications','')} {drug.get('desc','')}"
    )
    col.insert([[drug["id"]], [drug["name"]], [vec], [drug]])

def search_drugs(col: Collection, query: str, top_k: int = 10) -> List[Dict]:
    qvec = embed_text(query)
    res = col.search([qvec], "embedding", params={"metric_type":"COSINE"}, limit=top_k,
                     output_fields=["drug_id","name","metadata"])
    out = []
    for hits in res:
        for r in hits:
            out.append({
                "drug_id": r.id,
                "name": r.entity.get("name"),
                "meta": r.entity.get("metadata")
            })
    return out
```
#### backend/tools/rule_engine.py
```python
from typing import Dict

def evaluate_rules(drug: Dict, user_ctx: Dict) -> Dict:
    reasons, decision = [], "allow"

    if drug.get("is_rx") and not user_ctx.get("prescription_uploaded"):
        decision = "require_pharmacist_review"
        reasons.append("å¤„æ–¹è¯éœ€è¯å¸ˆå¤æ ¸æˆ–ä¸Šä¼ å¤„æ–¹")

    contraindications = drug.get("contraindications", [])
    if "pregnancy" in contraindications and user_ctx.get("pregnant"):
        decision = "block"
        reasons.append("å¦Šå¨ ç¦ç”¨")

    flags = drug.get("flags", [])
    if "fever_high" in flags and (user_ctx.get("fever_celsius") or 0) >= 39:
        decision = "require_pharmacist_review"
        reasons.append("é«˜çƒ­çº¢æ——ï¼Œå»ºè®®çº¿ä¸‹å°±åŒ»")

    return {"decision": decision, "reasons": reasons}
```
#### backend/tools/symptom_to_plan.py
```python
from typing import Dict
from .drug_search import search_drugs
from .rule_engine import evaluate_rules

def generate_plan(symptom_text: str, col, user_ctx: Dict) -> Dict:
    candidates = search_drugs(col, symptom_text, top_k=20)
    minimal = []
    for c in candidates:
        r = evaluate_rules(c["meta"], user_ctx)
        if r["decision"] == "allow":
            minimal.append({"drug": c, "rule": r})

    plan = {"items": [{"drug_id": d["drug"]["drug_id"], "dose": "æŒ‰è¯´æ˜ä¹¦", "notes": "å¤šé¥®æ°´"} for d in minimal]}
    return {"plan": plan, "explain": "æ¨¡å‹å»ºè®®éœ€è¯å¸ˆå¤æ ¸"}
```
#### backend/tools/pricing_inventory.py ä¸ order_checkout.py
```python
def enrich_with_price_inventory(db, plan, member_tier: str):
    items = []
    for it in plan["items"]:
        inv = db.get_inventory(it["drug_id"])
        price = db.get_price(it["drug_id"], member_tier)
        items.append({
            **it,
            "stock": inv["stock"],
            "unit_price": price["list_price"],
            "discount_rate": price.get("discount_rate", 1.0),
            "final_price": price["list_price"] * price.get("discount_rate", 1.0)
        })
    return items

def create_order(db, member_id: int, items: list):
    total = sum(i["final_price"] for i in items)
    order_id = db.insert_order(member_id, items, total)
    return {"order_id": order_id, "total": total, "payment_qr": f"/pay/{order_id}"}
```
#### backend/mcp/registry.pyï¼ˆå·¥å…·æ³¨å†Œä¸å®¡è®¡ï¼‰
```python
from typing import Callable, Dict
from .audit import audit_log

TOOLS: Dict[str, Callable] = {}

def register_tool(name: str, fn: Callable):
    TOOLS[name] = fn

def call_tool(name: str, *args, **kwargs):
    res = TOOLS[name](*args, **kwargs)
    audit_log(name, args, kwargs, res)
    return res
```
#### backend/mcp/audit.py
```python
import json, time

def audit_log(tool, args, kwargs, res):
    print(json.dumps({
        "ts": time.time(),
        "tool": tool,
        "args": str(args),
        "kwargs": kwargs,
        "result_summary": str(res)[:200]
    }))
```
#### backend/app.pyï¼ˆFastAPI è·¯ç”±ï¼‰
```python
from fastapi import FastAPI
from config import init_milvus
from tools.symptom_to_plan import generate_plan
from tools.pricing_inventory import enrich_with_price_inventory
from tools.order_checkout import create_order

app = FastAPI()
col = init_milvus()

# ä¼ª DB é€‚é…å™¨ï¼ˆç¤ºä¾‹ï¼‰
class DB:
    def get_inventory(self, drug_id): return {"stock": 100}
    def get_price(self, drug_id, tier): return {"list_price": 39.9, "discount_rate": 0.9 if tier=="gold" else 1.0}
    def insert_order(self, member_id, items, total): return 10001

db = DB()

@app.post("/symptom/plan")
def symptom_plan(payload: dict):
    user_ctx = payload.get("user_ctx", {})
    plan = generate_plan(symptom_text=payload["symptom"], col=col, user_ctx=user_ctx)
    items = enrich_with_price_inventory(db=db, plan=plan["plan"], member_tier=payload.get("member_tier","basic"))
    order = create_order(db=db, member_id=payload.get("member_id",1), items=items)
    return {"plan": plan, "items": items, "order": order}
```
#### backend/seeds/seed.pyï¼ˆç§å­æ•°æ®å…¥åº“ï¼‰
```python
import csv, json
from pymilvus import connections, Collection
from tools.drug_search import upsert_drug

connections.connect(host="milvus", port="19530")
col = Collection("drugs_vectors")

with open("seeds/drugs.csv", encoding="utf-8") as f:
    reader = csv.DictReader(f)
    for row in reader:
        drug = {
            "id": int(row["id"]),
            "name": row["name"],
            "indications": row.get("indications",""),
            "contraindications": json.loads(row.get("contraindications","[]")),
            "flags": json.loads(row.get("flags","[]")),
            "is_rx": row.get("is_rx","false").lower()=="true",
            "desc": row.get("desc","")
        }
        upsert_drug(col, drug)
print("Seeded drugs into Milvus.")
```
### å‰ç«¯ï¼ˆVue3ï¼‰æœ€å°é¡µé¢
#### package.json
```json
{
  "name": "pharmacy-web",
  "scripts": { "dev": "vite" },
  "dependencies": { "vue": "^3.4.0", "axios": "^1.6.0" },
  "devDependencies": { "vite": "^5.0.0", "@vitejs/plugin-vue": "^5.0.0" }
}
``
#### src/main.ts
```ts
import { createApp } from "vue";
import App from "./App.vue";
createApp(App).mount("#app");
```
#### src/App.vueï¼ˆè·¯ç”±ç®€åŒ–ä¸ºå•é¡µï¼‰
```vue
<template>
  <div class="p-4">
    <h2>ç—‡çŠ¶è§£æä¸ä¸‹å•</h2>
    <textarea v-model="symptom" rows="4" placeholder="è¾“å…¥ç—‡çŠ¶..."></textarea>
    <button @click="submit">ç”Ÿæˆç”¨è¯æ¸…å•</button>

    <div v-if="resp">
      <h3>ç”¨è¯æ¸…å•</h3>
      <pre>{{ resp.plan }}</pre>
      <h3>ä»·æ ¼ä¸åº“å­˜</h3>
      <pre>{{ resp.items }}</pre>
      <h3>è®¢å•</h3>
      <pre>{{ resp.order }}</pre>
    </div>
  </div>
</template>

<script setup lang="ts">
import axios from "axios";
import { ref } from "vue";
const symptom = ref("");
const resp = ref<any>(null);
async function submit() {
  const { data } = await axios.post("http://localhost:8000/symptom/plan", {
    symptom: symptom.value,
    user_ctx: { pregnant: false, prescription_uploaded: false, fever_celsius: 37.5 },
    member_tier: "gold",
    member_id: 1
  });
  resp.value = data;
}
</script>
```
### ä¸€é”®å¯åŠ¨ä¸åˆå§‹åŒ–
#### Makefile
```makefile
up:
\tdocker compose -f infra/docker-compose.yml up -d
milvus-init:
\tdocker exec -it milvus python /workspace/infra/milvus/init_collection.py
seed:
\tdocker exec -it pharmacy-api python /app/seeds/seed.py
down:
\tdocker compose -f infra/docker-compose.yml down
```
#### å¯åŠ¨æ­¥éª¤
1. **é…ç½®å¯†é’¥**ï¼šå¤åˆ¶ `infra/.env.example` ä¸º `.env`ï¼Œå¡«å…¥ `DEEPSEEK_API_KEY`ã€‚
2. **å¯åŠ¨å®¹å™¨**ï¼š`make up`
3. **åˆå§‹åŒ– Milvus é›†åˆ**ï¼š`make milvus-init`
4. **å¯¼å…¥ç§å­æ•°æ®**ï¼š`make seed`
5. **è®¿é—®å‰ç«¯**ï¼šæµè§ˆå™¨æ‰“å¼€ `http://localhost:5173`ï¼Œè¾“å…¥ç—‡çŠ¶å¹¶ç”Ÿæˆç”¨è¯æ¸…å•ã€‚

> è¯´æ˜ï¼šDeepSeek çš„ Embedding/Chat åœ¨æœ¬éª¨æ¶ä¸­ä»¥å ä½å®ç°ï¼›ä½ å¯ä»¥æŒ‰ Milvus å®˜æ–¹æ•™ç¨‹æ›¿æ¢ä¸ºçœŸå®è°ƒç”¨ï¼ˆOpenAIé£æ ¼ APIï¼‰ï¼Œå¹¶å°†ç”Ÿæˆçš„è¯å“åŸºç¡€ä¿¡æ¯ä¸åµŒå…¥å†™å…¥ Milvusã€‚ 
### åç»­å¢å¼ºå»ºè®®
- **çœŸå® DeepSeek æ¥å…¥**ï¼šå°† `embed_text` ä¸ç—‡çŠ¶åˆ°ç”¨è¯å»ºè®®æ”¹ä¸ºçœŸå® APIï¼›ä¸ºæç¤ºè¯ä¸å“åº”åšå®¡è®¡ç•™ç—•ã€‚
- **è§„åˆ™é…ç½®ä¸­å¿ƒ**ï¼šæŠŠç¦å¿Œ/çº¢æ——/å¤„æ–¹è§„åˆ™æŠ½æˆ JSON Schema ä¸ç®¡ç†åå°ã€‚
- **è¯å¸ˆå¤æ ¸é¡µ**ï¼šåœ¨å‰ç«¯å¢åŠ å¤æ ¸å·¥ä½œæµä¸è¦†ç›–å†³ç­–èƒ½åŠ›ã€‚
- **å¬å›è¯„ä¼°**ï¼šå®šæœŸè¯„ä¼° Milvus Top-K å‘½ä¸­ç‡ä¸ç”¨æˆ·åé¦ˆï¼Œä¼˜åŒ–æ–‡æœ¬æ¸…æ´—ä¸ç´¢å¼•å‚æ•°ã€‚
- **äº‘ä¸Šæ‰˜ç®¡**ï¼šå¦‚éœ€äº‘ä¸Šæ‰˜ç®¡ä¸ä¸€ä½“åŒ–å·¥ä½œæµï¼Œå¯å‚è€ƒäº‘å‚å•†çš„ Milvus+LangChain+DeepSeek RAG æ–¹æ¡ˆæ–‡ç« è¿›è¡Œæ‰©å±•ã€‚ 

## åŠŸèƒ½åˆ—è¡¨
- ç—‡çŠ¶è§£æå·¥å…·ï¼šè¾“å…¥ç—‡çŠ¶æ–‡æœ¬ â†’ è¾“å‡ºç»“æ„åŒ–ç—‡çŠ¶ã€çº¢æ——æ ‡è®°ã€‚
- è¯å“æ£€ç´¢å·¥å…·ï¼šé™å®šè¯åº—è‡ªæœ‰è¯å“ï¼Œé€šè¿‡ API æŸ¥è¯¢ã€‚
- è§„åˆ™å¼•æ“å·¥å…·ï¼šæ£€æŸ¥ç¦å¿Œã€å¤„æ–¹è¯ã€çº¢æ—— â†’ è¿”å›æ˜¯å¦é˜»æ­¢ã€‚
- è®¢å•æœåŠ¡å·¥å…·ï¼šç”Ÿæˆè®¢å•ï¼Œè‡ªåŠ¨è®¡ç®—ä¼šå‘˜æŠ˜æ‰£ã€‚
- å¤æ ¸æ—¥å¿—å·¥å…·ï¼šè®°å½•è¯å¸ˆæ“ä½œï¼ˆæ‰¹å‡†/é©³å›åŠåŸå› ï¼‰ã€‚
- ç»Ÿè®¡æŠ¥è¡¨å·¥å…·ï¼šæŒ‰è¯å¸ˆå’Œæ—¶é—´èŒƒå›´ç»Ÿè®¡æ‰¹å‡†/é©³å›æ•°é‡ã€‚
## è¯å“ç³»ç»Ÿä¿¡æ¯
### ğŸ·ï¸ åŸºæœ¬ä¿¡æ¯
- **è¯å“é€šç”¨å**ï¼šå›½é™…é€šç”¨æˆ–å›½å®¶æ ‡å‡†åç§°ã€‚  
- **å•†å“å/å“ç‰Œå**ï¼šå¸‚åœºé”€å”®åç§°ã€‚  
- **å‰‚å‹**ï¼šç‰‡å‰‚ã€èƒ¶å›Šã€æ³¨å°„æ¶²ã€å£æœæ¶²ç­‰ã€‚  
- **è§„æ ¼**ï¼šæ¯ç‰‡/æ¯æ”¯å«é‡ï¼Œå¦‚ 500mg/ç‰‡ã€‚  
- **åŒ…è£…ä¿¡æ¯**ï¼šåŒ…è£…å•ä½ã€æ•°é‡ã€‚  
### ğŸ“š è¯ç†ä¸é€‚åº”ç—‡
- **è¯ç†ä½œç”¨**ï¼šä¸»è¦æœºåˆ¶ï¼Œå¦‚æŠ—èŒã€è§£çƒ­é•‡ç—›ã€‚  
- **é€‚åº”ç—‡**ï¼šå¸¸è§çš„æ²»ç–—ç”¨é€”ï¼ˆä¾‹å¦‚ï¼šç”¨äºç¼“è§£å’³å—½ã€é€€çƒ§ï¼‰ã€‚  
- **ç¦å¿Œç—‡**ï¼šä¸é€‚åˆä½¿ç”¨çš„æƒ…å†µï¼ˆå¦‚å­•å¦‡ã€å„¿ç«¥ã€è‚è‚¾åŠŸèƒ½ä¸å…¨ï¼‰ã€‚  
- **æ³¨æ„äº‹é¡¹**ï¼šç‰¹æ®Šäººç¾¤ä½¿ç”¨æ³¨æ„ã€‚  
### âš ï¸ å®‰å…¨ä¸åˆè§„ä¿¡æ¯
- **ä¸è‰¯ååº”**ï¼šå¯èƒ½å‡ºç°çš„å‰¯ä½œç”¨ã€‚  
- **ç›¸äº’ä½œç”¨**ï¼šä¸å…¶ä»–è¯ç‰©ã€é£Ÿç‰©çš„ç›¸äº’å½±å“ã€‚  
- **è­¦ç¤ºä¿¡æ¯**ï¼šé»‘æ¡†è­¦å‘Šæˆ–ç›‘ç®¡è¦æ±‚ã€‚  
- **æ‰¹å‡†æ–‡å·**ï¼šå›½å®¶è¯ç›‘å±€æˆ– FDA æ‰¹å‡†ç¼–å·ã€‚  
### ğŸ¥ ç®¡ç†ä¸æµé€šä¿¡æ¯
- **ç”Ÿäº§å‚å®¶**ï¼šè¯å“ç”Ÿäº§ä¼ä¸šã€‚  
- **æµé€šæ¸ é“**ï¼šæ‰¹å‘ã€é›¶å”®ã€åŒ»é™¢è¯æˆ¿ã€‚  
- **åº“å­˜ä¸æœ‰æ•ˆæœŸ**ï¼šè¯å“æ‰¹æ¬¡ã€ä¿è´¨æœŸã€åº“å­˜æ•°é‡ã€‚  
- **ç›‘ç®¡åˆ†ç±»**ï¼šå¤„æ–¹è¯ã€éå¤„æ–¹è¯ï¼ˆOTCï¼‰ã€ç‰¹æ®Šç®¡ç†è¯å“ã€‚  
### ğŸ“Š æ‰©å±•ä¿¡æ¯
- **ä»·æ ¼ä¿¡æ¯**ï¼šé›¶å”®ä»·ã€åŒ»ä¿æŠ¥é”€ä»·æ ¼ã€‚  
- **åŒ»ä¿ç›®å½•æƒ…å†µ**ï¼šæ˜¯å¦çº³å…¥åŒ»ä¿ã€‚  
- **ä¸´åºŠæŒ‡å—æ¨è**ï¼šæ˜¯å¦åœ¨ä¸´åºŠè·¯å¾„æˆ–æŒ‡å—ä¸­æ¨èã€‚  
- **ç”µå­åŒ–ç¼–ç **ï¼šå¦‚è¯å“ç¼–ç ã€æ¡å½¢ç ã€UDIã€‚
### ğŸ“Œ æ€»ç»“
ğŸ‘‰ è¯å“ç³»ç»Ÿä¿¡æ¯é€šå¸¸åŒ…æ‹¬ **åŸºæœ¬ä¿¡æ¯ã€è¯ç†ä¸é€‚åº”ç—‡ã€å®‰å…¨ä¸åˆè§„ã€ç®¡ç†ä¸æµé€šã€æ‰©å±•ä¿¡æ¯** äº”å¤§ç±»ã€‚è¿™äº›ä¿¡æ¯å…±åŒä¿è¯è¯å“åœ¨ç ”å‘ã€ç”Ÿäº§ã€æµé€šã€ä¸´åºŠä½¿ç”¨å’Œç›‘ç®¡ç¯èŠ‚çš„é€æ˜ä¸åˆè§„ã€‚  
